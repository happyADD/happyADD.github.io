---
title: 卫惯组合导航在单片机上的部署
collection: talks
type: Talk
permalink: /talks/卫惯组合导航在单片机上的部署
venue: 南航NRC项目
date: "2025-10-01"
excerpt: " 基于 STM32H7 的 IMU+GNSS 多源融合导航系统，实现高精度定位、测速与测姿"
roles: 硬件部分开发

---
# 卫惯耦合组合导航系统

> 基于 STM32H7 的 IMU+GNSS 多源融合导航系统，实现高精度定位、测速与测姿

## 项目概述

本项目面向机器人高精度导航需求，构建基于 STM32H7 的卫惯（惯性导航+卫星导航）耦合组合导航系统。通过集成惯导模块与卫星导航模块，采用松耦合导航算法，解决单一传感器的局限性，实现微秒级时间同步与稳定的位置、速度、姿态（6DoF）输出，适配嵌入式实时性与工程化应用场景。

## 核心技术栈

### 🔧 硬件平台

| 模块       | 型号/规格               | 作用                     |
| ---------- | ----------------------- | ------------------------ |
| 主控芯片   | STM32H7（主频480Hz）  | 系统核心控制与算法运行   |
| 惯性导航模块 | WHEELTEC N100     | 输出加速度、角速度原始数据 |
| 卫星导航模块 | WHEELTEC G60      | 输出位置、速度及UTC时间 |
| 通信接口   | UART1/UART2/UART3 | 数据收发（分路适配传感器） |
| 授时模块   | PPS信号             | 时间同步校准        |
| 辅助工具   | LCEDA             | 接线拓扑规划与硬件适配   |

### 💻 软件与工具链

- 开发环境：STM32CubeMX + Keil MDK5（HAL库自动配置）
- 核心算法：卡尔曼滤波（误差状态估计，多源数据融合）
- 编译方式：armccv6 混合 C/C++ 编译
- 工具库：二次开发矩阵库（替代 Eigen，适配 STM32 硬件）
- 通信协议：NMEA0183（GPS）、FDI 通信协议（惯导）
- 系统调度：TIM2（微秒级计时）、TIM3（定时回调反馈），待集成 FreeRTOS
- 调试工具：FDI 上位机、GnssToolKit3、串口助手（数据监控）

## 功能实现亮点

**微秒级授时同步机制**  
构建双阶段时间校准流程，保障 IMU 与 GPS 数据时间对齐：
```
1. UTC更新：解析NMEA报文获取最新UTC时间，更新SyncTimeTable（系统时间-UTC映射表）
2. PPS校准：捕捉PPS信号上升沿，校准UTC为整数时刻，调用getGlobalTime同步系统计时
```
通过 uint64 微秒级系统计时与 double 型 UTC 时间的格式转换，解决多源数据时间戳不一致问题。

**松耦合卫惯导航**  
针对单一传感器缺陷，设计误差状态卡尔曼滤波算法：
- 状态向量包含导航误差（位置/速度/姿态）与传感器误差（陀螺仪/加速度计固定误差、随机噪声等）
- 预测阶段：基于 IMU 数据解算姿态（atti_cal_cq_modi）、速度（velo_cal）、位置（posi_cal）
- 更新阶段：GPS 信号有效时触发 kalm_gps 融合，修正导航结果，抑制 IMU 累积误差

**模块化硬件与通信适配**  
- 差异化串口配置：UART2 接收 GPS 数据（波特率9600），UART3 接收 IMU 数据（波特率921600），UART1 输出融合结果
- 标准化接线设计：按 LCEDA 规范定义引脚映射，保障硬件稳定性
- 独立供电优化：卫星模块单独 Type-C 供电，避免通信干扰

**工程化二次开发优化**  
基于 SJTU-RoboMaster-Team 开源项目二次开发，自主实现矩阵库替代 Eigen，适配 STM32H7 硬件资源；模块化拆分数据采集、解算、融合、输出流程，预留 FreeRTOS 集成接口，支持后续多任务调度扩展。

## 项目成果

- 实现 IMU 与 GPS 数据的实时采集、时间同步与融合，稳定输出高精度位置（posiN）、速度（veloN）、姿态（attiN）数据
- 搭建完整的卫惯耦合技术框架，通过卡尔曼滤波有效抑制传感器噪声与累积误差，提升导航鲁棒性
- 完成硬件接线标准化与软件模块化开发，具备快速迭代与工程落地能力
- 适配 RoboMaster 等移动机器人场景，为自主定位导航提供核心技术支撑

### 评曰

打完比赛进入大三阶段开始接触卫惯耦合核心领域，时间同步处理较为耗时，既打通了嵌入式硬件适配、通信协议解析、滤波算法实现的全流程，也为机器人高精度导航积累了工程化实践经验。